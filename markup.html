<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="color-scheme" content="light dark" />
        <title> ATHN markup language specification </title
    </head>
    <body>
        <h1> ATHN markup language specification </h1>
        <p> Project ATHN is still very early in development. Suggestions and discussion are very welcome. Expect everything to change at any time. </p>
        <h2> Introduction </h2>
        <p> ATHN markup language is the backbone of the project, it's the plain text format that makes up every ATHN site. It's intended to be as protocol agnostic as reasonable. Right now https is used to exchange the markup files, but in theory any other protocol, maybe even a custom one specifically tailored to the needs of this project, could be used for that purpose. </p>
        <p> Generally complexity is put on the client software, making the server software simpler to ease site development</p>
        <h2> 1 Terminology </h2>
        <p> The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP14. </p>
        <p> A client is any software that recieves an ATHN markup document </p>
        <p> A server is any software that sends ATHN markup documents </p>
        <p> Whenever an example of a keyword is given in this specification it's case sensitive unless otherwise noted and has the bytes that make it up written in paretheses next to it. The bytes MUST match exactly, whitespace characters are not ignored.</p>

        <h2> 2 Line types </h2>
        <p> An ATHN markup document can be analyzed line by line. Each line, except text lines, start with a 3 byte <em>line type identifier (LTI)</em> followed by the content of the line. Every line type has a unique LTI so that the type of any line can be determined unambiguously by knowing the section of the line and inspecting its first 3 bytes. If the first 3 bytes dont match any valid LTI, the line is considered a text line. Each line type has its own rules about how it should be processed, and not all of them should be presented to humans. Blank lines are ignored.</p>

        <h3> 2.1 Text lines </h3>
        <p> As the name suggests text lines just contain plain text. Text lines are rendered as is. But they have one special feature: formatting </p>
        <p> Available in: 'Main', 'Footer' and 'Form'</p>
        <p> If the line type cannot be determined to be something else it's a text line. </p>
        <h4> 2.1.1 Text line formatting </h4>
        <p> Text lines can contain a few special formatting character sequences. They should not be rendered, but MAY be ignored. When the line ends all formatting is implicitly reset. The special sequences are as follows: </p>
        <p> <kbd>\r</kbd> (0x5c 0x72) </p>
        <p> Resets all formatting </p>
        <p> <kbd>\b</kbd> (0x5c 0x62) </p>
        <p> Enables bold text formatting </p>
        <p> <kbd>\i</kbd> (0x5c 0x69) </p>
        <p> Enables italic text formatting </p>
        <p> <kbd>\p</kbd> (0x5c 0x70) </p>
        <p> Enables monospaced formatting </p>
        <p> On the rare occation that you do need to write any of the control sequences in a text line you can write it like this <kbd>\â€‹b</kbd> (0x5c 0xe2 0x80 0x8b 0x62) with a zero width space or similar in between the backslash character and the letter </p>

        <h3> 2.2 Section lines </h3>
        <p> Section lines MUST NOT be rendered. Section lines change the section of every following line (until a new section line is encountered). The 'Meta' section MUST be the first section in the document. Any of the other sections can occur on any line after the 'Meta' section.</p>
        <p> LTI: <kbd>+++</kbd> (0x2d 0x2d 0x2d)</p>
        <p> The content of a section line is only valid if it is one of the following:</p>
        <p> Nothing </p>
        <p> Changes the section to 'Main'. It is required and must occur 1 or more times per document. </p>
        <p> <kbd> Meta</kbd> (0x20 0x4d 0x65 0x74 0x61) </p>
        <p> Changes the section to 'Meta'. The 'Meta' section is required and only allowed once. It MUST be the first section in the document.</p>
        <p> <kbd> Header</kbd> (0x20 0x48 0x65 0x61 0x64 0x65 0x72) </p>
        <p> Changes the section to 'Header'. Is optional and only allowed 1 or 0 times per document. </p>
        <p> <kbd> Footer</kbd> (0x20 0x46 0x6f 0x6f 0x74 0x65 0x72) </p>
        <p> Changes the section to 'Footer'. Is optional and only allowed 1 or 0 times per document. </p>
        <p> <kbd> Form</kbd> (0x20 0x46 0x6f 0x72 0x6d) </p>
        <p> Changes the section to 'Form'. Is optional and allowed any number of times per document. </p>

        <h3> 2.3 Metadata tag lines </h3>
        <p> Metadata tag lines is a collection of line types, used for metadata, each type of metadata tag line is called a tag. Some tags can occur more than once, their order matters and MUST be preserved unless otherwise noted. </p>
        <p> Available in: 'Meta'. In fact they are the only permitted line type in the 'Meta' section. </p> 
        <p> LTI: 2 capitalized letters followed by a space. </p>
        <p> These are the valid metadata tags and their rules, they MUST occur in this order in the document:</p>
        <h4> 2.3.1 Title tag </h4>
        <p> <kbd>TI </kbd> (0x54 0x49 0x20) </p>
        <p> The title tag is REQUIRED, it can only occur once, maximum size is 2048 bytes. It SHOULD be shown to the human, typically in a big font at the top of the site, but can usually just be ignored by automatic clients. </p>
        <h4> 2.3.2 Subtitle tag </h4>
        <p> <kbd>ST </kbd> (0x53 0x54 0x20) </p>
        <p> The subtitle tag can only occur once, the maximum size is 16384 bytes. It SHOULD be shown to the human.</p>
        <h4> 2.3.3 Author tag </h4>
        <p> <kbd>AU </kbd> (0x41 0x55 0x20) </p>
        <p> The author tag can occur up to 16 times. Maximum size is 1024 bytes. </p>
        <h4> 2.3.4 License tag </h4>
        <p> <kbd>LI </kbd> (0x4c 0x49 0x20) </p>
        <p> The license tag specifies what license the whole document is under, it applies to the whole document. It can be any identifier in the SPDX license list or a URL to a custom license. It can occur up to 4 times. The maximum size is 2048 bytes.</p>
        <h4> 2.3.5 Language tag </h4>
        <p> <kbd>LA </kbd> (0x4c 0x41 0x20) </p>
        <p> The first occurence of the language tag tells the client what language the current document is (primarily) written in. All subsequent occurences mean that the document is also available in that language. Can occur up to 256 times. The content of the tag is a language string as defined in BCP47. It's important that the first occurence comes first, but the order of the rest is not important.</p>
        <h4> 2.3.6 Cache duration tag</h4>
        <p> <kbd>CH </kbd> (0x43 0x48 0x20) </p>
        <p> The cache duration tag is an unsigned 32 bit integer, it can only occur once. It is the number of seconds that the page should be cached by clients that support caching. The special value of 0 is used for an infinite cache time.</p>

        <h3> 2.4 Link lines </h3>
        <p> Link lines are used to redirect to any other document or file of any sort. Link lines are the primary (only) way to have images, video, other multimedia, tables and anything else not supported by ATHN markup in an ATHN markup document. They are of course also used to link to other ATHN documents. They are typically underlined, colored or have some other formatting that indicates that they're interactive. When activated by a human the link SHOULD open in their prefered app, the exception being other ATHN documents which MAY be opened/redirected to in the client app. </p>
        <p> Available in: 'Main', 'Header', 'Footer' and 'Form'. They are the only allowed line type in the 'Header' section. </p>
        <p> LTI: <kbd>=> </kbd> (0x3d 0x3e 0x20) </p>
        <p> The content of a link line always starts with a URL (absolute or relative) with spaces and other reserved characters percent-encoded as per RFC 3986. Optionally followed by a space (0x20) character, followed by a label. When no label is specified, the url is shown, otherwise only the label is shown. If a label is present the client MAY still show the url to the human upon request. </p>

        <h3> 2.5 Preformatted lines </h3>
        <p> Preformatted lines are rendered in a monospaced font with unaltered whitespace. Preformatted lines SHOULD NOT be wrapped. Preformatted lines are used for things like source code, terminal outputs, ASCII art or anything else where it's important to preserve whitespacing or use a fixed width font. </p>
        <p> Available in: 'Main' and 'Form' </p>
        <p> LTI: <kbd>```</kbd> (0x60 0x60 0x60) </p>
        <p> Alternative LTI: <kbd>'''</kbd> (0x27 0x27 0x27) can be used to indicate that the content of the preformatted line is textual and makes sense to read (this would mean that a screen reader would read it out loud). The difference between the 2 LTIs is purely a matter of accessibility role. </p>
        <h4> 2.5.1 Code blocks </h4>
        <p> Advanced clients MAY choose to render continous sequences of preformatted lines into a single "code" block. If they do that they MUST not differentiate between the 2 different types of preformatted lines. </p>
        <p> If an author makes a code block containing for example ASCII art, they can chose to start the block with a line beginning with <kbd>'''</kbd> and containing a title which would be read aloud by the screen reader. Then make the rest of the block's lines start with <kbd>```</kbd> which would, correctly, not be read by the screen reader since it isnt text. </p>
        <h4> 2.5.2 Source code highlighting </h4>
        <p> It would be unreasonable to assume of clients that they can correctly highlight source code of any kind. If you want source code to be highlighted you can use ASCII control codes to do the highlighting, but dont expect all clients to show the highlighting. This has the benefit that you can be sure that your source code is always correctly highlighted (if the client supports it). With the drawback that it's more difficult for you to write it. Another drawback is that the client wont get to apply its own color scheme. </p> 
        <p> The reasoning behind this decision is that if there's one thing that's worse than unhighlighted source code, it's incorrectly highligted source code, and you cant expect clients to know every code language in the world. </p>

        <h3> 2.6 Separator </h3>
        <p> The separator line type is used to separate paragraphs, code blocks or in other circumstances where you might otherwise use a blank line. Since blank lines are ignored and using text lines containing nothing but whitespace is hacky. Separator lines are rendered as a horizontal line, extra spacing or something similar. </p>
        <p> Available in: 'Main' and 'Form' </p>
        <p> LTI: <kbd>---</kbd> (0x5f 0x5f 0x5f) </p>
        <p> Separator lines MUST NOT contain any content </p>

        <h3> 2.7 Unordered list lines </h3>
        <p> Unordered list lines are lines rendered starting with a bullet (the specific symbol is up to the client and could differ depending on the level of indentation) and indented to indicate that it's part of a list. Unordered lists support 6 levels of indentation. </p>
        <p> Available in: 'Main' and 'Form' </p>
        <p> LTI: a number corresponding to the level of indentation followed by a <kbd>*</kbd> (0x2a) character followed by a space character. That makes the following LTIs specify unordered list lines:</p>
        <p> <kbd>1* </kbd> (0x31 0x2a 0x20): Unordered list line indented by 1</p>
        <p> <kbd>2* </kbd> (0x32 0x2a 0x20): Unordered list line indented by 2</p>
        <p> <kbd>3* </kbd> (0x33 0x2a 0x20): Unordered list line indented by 3</p>
        <p> <kbd>4* </kbd> (0x34 0x2a 0x20): Unordered list line indented by 4</p>
        <p> <kbd>5* </kbd> (0x35 0x2a 0x20): Unordered list line indented by 5</p>
        <p> <kbd>6* </kbd> (0x36 0x2a 0x20): Unordered list line indented by 6</p>
        <p> The content of an unordered list line can be anything </p>

        <h3> 2.8 Ordered list lines </h3>
        <p> Ordered list lines are identical to unordered list lines except the author gets to choose the bullet. </p>
        <p> Available in: 'Main' and 'Form' </p>
        <p> LTI: a number corresponding to the level of indentation followed by a <kbd>-</kbd> (0x2d) character followed by a space character. That makes the following LTIs specify unordered list lines:</p>
        <p> <kbd>1- </kbd> (0x31 0x2d 0x20): Ordered list line indented by 1</p>
        <p> <kbd>2- </kbd> (0x32 0x2d 0x20): Ordered list line indented by 2</p>
        <p> <kbd>3- </kbd> (0x33 0x2d 0x20): Ordered list line indented by 3</p>
        <p> <kbd>4- </kbd> (0x34 0x2d 0x20): Ordered list line indented by 4</p>
        <p> <kbd>5- </kbd> (0x35 0x2d 0x20): Ordered list line indented by 5</p>
        <p> <kbd>6- </kbd> (0x36 0x2d 0x20): Ordered list line indented by 6</p>
        <p> The content of an ordered list line starts with the bullet symbol(s) followed by a space character (0x20) followed by the content of the list item </p>
        <h4> 2.8.1 Considerations about custom bullets </h4>
        <p> Requiring the author to number the list items themselves is a bit more difficult on the author. But it does also provide a lot of flexibility in terms of how you choose to number them. You could number them with numbers, letters, roman numerals or not number them at all but just use a special bullet symbol (this would be how you do checklists). It also allows you to stick a text line in between 2 list items in an ordered list without breaking the numbering flow. </p>

        <h3> 2.9 Dropdown lines </h3>
        <p> A dropdown is used to hide a long and not neccesary to read paragraph behind a shorter label. Only the label is shown until the human requests to see the hidden content of the dropdown line. </p>
        <p> Available in: 'Main' and 'Form' </p>
        <p> LTI: <kbd>\/ </kbd> (0x5c 0x2f 0x20) </p>
        <p> Dropdown lines start with the label followed by these 3 characters <kbd> | </kbd> (0x20 0x7c 0x20) followed by the hidden content </p>

        <h3> 2.10 Heading lines </h3>
        <p> There are 6 levels of heading lines. They are typically rendered in a bigger and differently weighted font than text lines. Simple clients MAY choose to treat them identically to text lines (with the LTI shown to the human). Headings do not support formatting, only text lines do. Conventionally the title metadata tag is used as the title of the page, not a level 1 heading. </p>
        <p> Available in: 'Main' and 'Form' </p>
        <p> LTI: a <kbd>#</kbd> (0x23) character, followed by a number corresponding to the level of the heading, followed by a space (0x20) character. That makes the following LTIs specify heading lines: </p>
        <p> <kbd>#1 </kbd> (0x23 0x31 0x20): Level 1 heading line</p>
        <p> <kbd>#2 </kbd> (0x23 0x32 0x20): Level 2 heading line</p>
        <p> <kbd>#3 </kbd> (0x23 0x33 0x20): Level 3 heading line</p>
        <p> <kbd>#4 </kbd> (0x23 0x34 0x20): Level 4 heading line</p>
        <p> <kbd>#5 </kbd> (0x23 0x35 0x20): Level 5 heading line</p>
        <p> <kbd>#6 </kbd> (0x23 0x36 0x20): Level 6 heading line</p>
        <p> The content of a heading line can be anything </p>

        <h3> 2.11 Quote lines </h3>
        <p> Quote lines are used for quotes. They are usually formatted in a certain way to indicate that the line is a quote, or might just by wrapped in quotation marks. Simple clients MAY choose to treat quote lines identically to text lines. Multiline quotes are not supported. </p>
        <p> Available in: 'Main' and 'Form' </p>
        <p> LTI: <kbd>&gt&gt </kbd> (0x3e 0x3e 0x20) </p>
        <p> The content of quote lines can be anything </p>


        <h2> 3 Section rules </h2>
        <h3> The 'Main' section</h3>
        <p> The 'Main' section contains the primary content of the page and MUST be presented to the human at all times in an appropriate manner. </p>
        <h3> The 'Header' section</h3>
        <p> The 'Header' section is a navigation bar of the site as a whole. It can only contain link lines. It contains the most important links to <em>other</em> documents that are relevant to the current one. It should be accessible, but can be hidden away sometimes, only be at the top of the page or be presented in some other way that makes sense given its role. </p>
        <h3> The 'Footer' section</h3>
        <p> The 'Footer' section is typically located at the bottom of the page and can contain link lines and regular text lines. It's typically used for persistent information about the page or site that isnt handled my the 'Meta' section. It could for example link to a privacy policy, or explain briefly what the company behind a site does. It isnt very important and doesnt need to be presented prominently to the human, but could be of interest and should be viewable. </p>

        <h2> 4 Forms </h2>

        <!--
            You've made it to the secret place where I note the things that might be cause for concern and should perhaps be changed.

            - Should whitespace automatically be trimmed from the beginning of lines? I wasnt initially much for it, because it could make the source code version of ATHN documents needlessly inconsistent. But since list lines dont get (actually) indented in the source code (which is a very good idea by the way) maybe we should allow people to indent the list item content after the LTI and just require that whitespace is trimmed at the beginning of the content of all lines
            - Black lines are currently ignored, we could also just save the step of ignoring the blank lines by disallowing blank lines entirely?
            - Maybe there should be some restrictions on the allowed bullet symbols in ordered list lines?
            - Consider swapping the number and # characters in the heading LTI to make it more similar to that of the lists
            - Should quotes support formatting?
            - Do we want footnotes or another thing with the same function?
            - Should we add strikethrough and or highlighted and or sub/superscript formatting?
            - Should there be an (admonition)[https://docutils.sourceforge.io/docs/ref/rst/directives.html#admonitions] line type?
        -->
    </body>
</html>
